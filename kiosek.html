<!doctype html>
<html lang="cs" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grafit ‚Äî Kiosk rotace karet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body { height:100%; }
    .card { transition: transform 300ms cubic-bezier(.2,.8,.2,1), box-shadow 300ms ease; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    .card .thumb { transform: scale(1.02); transition: transform 600ms cubic-bezier(.22,1,.36,1); }
    .card:hover .thumb { transform: scale(1.06); }
    .bg-gradient-dark { background: linear-gradient(#070b12,#0a0f18 55%,#090d14); }

    /* <-- nov√©: vodorovn√© p≈ôechody */
    .slide-enter          { opacity: 0; transform: translateX(40px) scale(.995); }
    .slide-enter-active   { opacity: 1; transform: translateX(0)    scale(1);    transition: opacity 450ms ease, transform 450ms ease; }
    .slide-exit           { opacity: 1; transform: translateX(0)    scale(1); }
    .slide-exit-active    { opacity: 0; transform: translateX(-40px) scale(.995); transition: opacity 380ms ease, transform 380ms ease; }
    .slide-enter-rev      { opacity: 0; transform: translateX(-40px) scale(.995); }
    .slide-exit-active-rev{ opacity: 0; transform: translateX(40px)  scale(.995); transition: opacity 380ms ease, transform 380ms ease; }

    /* mal√Ω podtitulek pod anotac√≠ (2. ≈ô√°dek) */
    .kiosk-sub { letter-spacing:.01em }
  </style>
</head>
<body class="min-h-screen bg-gradient-dark text-white">

  <canvas id="backCanvas" class="fixed inset-0 w-full h-full"></canvas>

  <header class="pointer-events-none fixed left-0 right-0 top-0 z-20">
    <div class="mx-auto max-w-[1400px] px-4 xl:px-6 py-4 flex items-center justify-between text-sm text-neutral-300/90">
      <div class="pointer-events-auto rounded-full border border-white/15 bg-black/30 px-3 py-1.5 backdrop-blur">
        Grafit Research Group ‚Äî slideshow
      </div>
      <div id="status" class="pointer-events-auto rounded-full border border-white/15 bg-black/30 px-3 py-1.5 backdrop-blur">
        ‚èµ bƒõ≈æ√≠ ¬∑ 15 s
      </div>
    </div>
  </header>

  <main class="relative z-10 min-h-screen flex items-center justify-center px-4">
    <div id="stage" class="w-[min(1200px,95vw)] touch-pan-y select-none"></div>
  </main>

  <div class="fixed right-4 bottom-4 z-20 flex gap-2">
    <button id="btnPrev" class="rounded-full border border-white/15 bg-black/40 px-3 py-1.5 text-sm hover:bg-white/10">‚Üê P≈ôedchoz√≠</button>
    <button id="btnToggle" class="rounded-full border border-white/15 bg-black/40 px-3 py-1.5 text-sm hover:bg-white/10">‚è∏ Pauza</button>
    <button id="btnNext" class="rounded-full border border-white/15 bg-black/40 px-3 py-1.5 text-sm hover:bg-white/10">Dal≈°√≠ ‚Üí</button>
  </div>

  <script>
    /* ====== DATA (zkr√°ceno: pou≈æij sv≈Øj pln√Ω seznam) ====== */
    const EVENTS = [
      { id:"e-gamejam-2025", title:"GameJam 2025", blurb:"Another installment in our series of traditional game jams! Once again over Easter, this time with a surprise ‚Äì judges from game studios and major companies.", img:"/assets/projects/majak2.png", href:"https://itch.io/jam/gamejam-fit-2025a", tags:["event","gamejam","community"], date:"Spring 2025" },
      { id:"e-hellofit-2025", title:"HelloFit 2025", blurb:"Part of our traditional freshmen events. We teamed up with Fit++, welcomed new students and invited them to our game design group and the STOH board-game club.", img:"/events/hellofit.jpg", href:"https://www.klubfitpp.cz/events/2025/hello-fit-25/", tags:["event","community","onboarding"], date:"2025" },
      { id:"e-gamejam-2024", title:"GameJam 2024", blurb:"Another traditional jam. Christmas edition with industry judges from game studios and major companies.", img:"/assets/projects/gamejam_2024b_logo.jpg", href:"https://itch.io/jam/gamejam-fit-2024-vanocni", tags:["event","gamejam"], date:"Dec 2024" },
      { id:"e-gexpo-2025", title:"GEXPO 2025", blurb:"Graphics Expo showcasing achievements of our students in game development, VR, and final projects. 60+ participants and a packed evening program.", img:"/assets/projects/gexpo_logo.jpg", href:"events/gexpo/2025", tags:["event","expo","students","vr","games"], date:"2025" },
      { id:"e-researchers-night-2025", title:"ResearchersNight 2025", blurb:"Celebrating 20 years of Researchers' Night in the Czech Republic across 50+ cities.", img:"/assets/projects/nocvedcu.png", href:"https://www.nocvedcu.cz/en", tags:["event","public","research"], date:"26 Sep 2025" },
      { id:"e-grafit-games-studio", title:"Grafit Games Studio", blurb:"Bridging cutting-edge research with creative game development across digital and board games.", img:"/assets/projects/grafitgames_logo.jpg", href:"https://barushe22.itch.io/neckventure", tags:["studio","games","event"], date:"ongoing" }
    ];
    const RESEARCH = [
      { id:"r-politeia21", title:"Politeia 21", blurb:"Interdisciplinary VR project exploring Plato‚Äôs theses, ethics and human behavior in a large-scale social simulation.", img:"/assets/projects/politeia.png", href:"https://www.unihack.cz/project/8", tags:["vr","simulation","social","philosophy","research"] },
      { id:"r-dowry-towns", title:"Dowry Towns of Bohemian Queens", blurb:"Projects mapping historical development and digitizing cultural heritage of royal dowry towns; VR reconstructions and archives.", img:"/assets/projects/vennamesta.png", href:"https://www.kralovskavennamesta.cz/", tags:["heritage","mapping","history","vr"], date:"2018‚Äì2022" },
      { id:"r-game-design", title:"Game design", blurb:"Research in game design theory: world design, accessibility for impaired users, and creative writing.", img:"/assets/projects/gamedesign.png", href:"/projects/", tags:["games","design","accessibility","writing"] },
      { id:"r-texture-modeling", title:"Texture modeling", blurb:"With the Institute of Information Theory and Automation (CAS), we analyze and model realistic material appearance (BRDF/BTF).", img:"/assets/projects/textures.jpg", href:"http://btf.utia.cas.cz/?brdf_dwn", tags:["materials","brdf","btf","collaboration"] },
      { id:"r-most-city", title:"Most ‚Äì city that did not disappear", blurb:"Reconstruction of the historic appearance of the city of Most prior to its major redevelopment.", img:"/assets/projects/most.png", href:"https://www.vugtk.cz/en/home-page/", tags:["heritage","reconstruction","city","3d"], date:"2023‚Äì2027" },
      { id:"r-tactile-wall", title:"Tactile interfaces: interactive wall", blurb:"Exploration of tactile-specific interfaces in collaboration with MIT, University of Tokyo, initi.org and CAMP.", img:"/assets/projects/intwall.png", href:"https://www.youtube.com/watch?v=3jvmoj7pLZU&ab_channel=IraWinder", tags:["haptics","ui","installation","collaboration"] }
    ];
    const SHOWCASE = [
      { id:"sc-wood-texture-generation", title:"Wood texture generation", blurb:"Plugin for creating artificial wood texture.", img:"/assets/showcase/jechdrevo.png", href:"https://iga.ksi.fit.cvut.cz/bi-pga/b241/3d/jechjose?class=3d", tags:["pga","texture","bachelor"] },
      { id:"sc-ai-texture-to-3d", title:"AI Texture to 3D generation", blurb:"Generate textures with AI and map them onto 3D assets.", img:"/assets/showcase/stablegen.jpg", href:"https://stablegen.ai", tags:["pga","ai","texture","3d","bachelor"] },
      { id:"sc-texture-editing", title:"Texture editing", blurb:"Content-aware fill implemented as a GIMP plugin.", img:"/assets/showcase/svabova.png", href:"https://gitlab.fit.cvut.cz/BI-PGA/stud/svabosa1/blob/master/dokumentace1.adoc", tags:["pga","gimp","content-aware"] },
      /* ... (ponech sv≈Øj kompletn√≠ seznam) ... */
    ];

    /* ====== Nastaven√≠ ====== */
    const INTERVAL_SEC = Number(new URLSearchParams(location.search).get("speed")) || 15;
    const SHUFFLE = (new URLSearchParams(location.search).get("shuffle")) === "1";
    const stage = document.getElementById("stage");
    const statusEl = document.getElementById("status");

    let rotation = [
      ...EVENTS.map(x => ({...x, kind:"event"})),
      ...RESEARCH.map(x => ({...x, kind:"research"})),
      ...SHOWCASE.map(x => ({...x, kind:"showcase"})),
    ];
    if (SHUFFLE) rotation = rotation.sort(()=>Math.random()-.5);

    let idx = 0, timer = null, playing = true, lastDir = 1; // 1=vp≈ôed, -1=zpƒõt

    function ellipsize(s="", n=120){
      const t = s.trim().replace(/\s+/g," ");
      return t.length <= n ? t : t.slice(0, n-1).trimEnd()+"‚Ä¶";
    }
    function subline(item){
      const t = (item.tags?.length ? "#"+item.tags.slice(0,3).join("  #") : "");
      const d = item.date ? ` ¬∑ ${item.date}` : "";
      return (t+d) || "Tap to open details";
    }

    function createCard(item){
      const a = document.createElement("a");
      a.href = item.href || "#"; a.target = "_blank"; a.rel = "noreferrer";
      a.className = "card block rounded-2xl overflow-hidden border border-white/10 bg-gradient-to-b from-neutral-900 to-black";

      const aspect = item.kind === "research" ? "aspect-[3/1]" : "aspect-[2/1]";
      const imgBox = document.createElement("div");
      imgBox.className = `relative w-full overflow-hidden ${aspect}`;
      const img = document.createElement("img");
      img.src = item.img; img.alt = item.title; img.loading="eager";
      img.className = "thumb h-full w-full object-cover object-center";
      imgBox.appendChild(img);
      const grad = document.createElement("div");
      grad.className = "absolute inset-0 bg-gradient-to-t from-black/55 to-transparent";
      imgBox.appendChild(grad);
      if (item.date){
        const badge = document.createElement("span");
        badge.className = "absolute left-3 top-3 inline-flex items-center gap-1 rounded-full bg-black/60 px-2 py-1 text-xs text-neutral-200 border border-white/10";
        badge.textContent = "üìÖ " + item.date;
        imgBox.appendChild(badge);
      }
      a.appendChild(imgBox);

      const body = document.createElement("div");
      body.className = "p-5";
      const top = document.createElement("div");
      top.className = "flex items-baseline justify-between";
      const h3 = document.createElement("h3");
      h3.className = "text-2xl font-semibold text-neutral-100";
      h3.textContent = item.title;
      const kind = document.createElement("span");
      kind.className = "rounded-md border border-white/10 bg-white/5 px-2 py-0.5 text-xs uppercase tracking-wide text-neutral-300";
      kind.textContent = item.kind;
      top.appendChild(h3); top.appendChild(kind);
      body.appendChild(top);

      // 1. ≈ô√°dek ‚Äì kr√°tk√° anotace (auto)
      const p = document.createElement("p");
      p.className = "mt-2 text-neutral-300/90 text-base leading-relaxed";
      p.textContent = ellipsize(item.blurb || "", 120);
      body.appendChild(p);

      // 2. ≈ô√°dek ‚Äì highlight (tagy / datum)
      const small = document.createElement("p");
      small.className = "kiosk-sub mt-1 text-sm text-neutral-400";
      small.textContent = subline(item);
      body.appendChild(small);

      // Tagy (vizu√°ln√≠ chips)
      if ((item.tags||[]).length){
        const tg = document.createElement("div");
        tg.className = "mt-4 flex flex-wrap gap-2";
        item.tags.forEach(t=>{
          const chip = document.createElement("span");
          chip.className = "text-xs rounded-full border px-2 py-0.5 text-neutral-300 border-neutral-700/80";
          chip.textContent = "#"+t;
          tg.appendChild(chip);
        });
        body.appendChild(tg);
      }
      a.appendChild(body);
      return a;
    }

    function renderSlide(i, dir=1){
      const item = rotation[(i+rotation.length)%rotation.length];

      // odjezd star√©ho
      if (stage.firstChild){
        const old = stage.firstChild;
        old.classList.add("slide-exit");
        requestAnimationFrame(()=>{
          old.classList.add(dir===1 ? "slide-exit-active" : "slide-exit-active-rev");
          setTimeout(()=> stage.removeChild(old), 400);
        });
      }

      // p≈ô√≠jezd nov√©ho
      const wrap = document.createElement("div");
      wrap.className = dir===1 ? "slide-enter" : "slide-enter-rev";
      wrap.appendChild(createCard(item));
      stage.appendChild(wrap);
      requestAnimationFrame(()=> wrap.classList.add("slide-enter-active"));

      statusEl.textContent = (playing ? "‚èµ bƒõ≈æ√≠" : "‚è∏ pauza") + " ¬∑ " + INTERVAL_SEC + " s ¬∑ " + ( (i%rotation.length)+1 ) + "/" + rotation.length;
      document.title = `${item.title} ‚Äî Grafit kiosk`;
    }

    function next(){ idx = (idx+1)%rotation.length; lastDir=1; renderSlide(idx, +1); }
    function prev(){ idx = (idx-1+rotation.length)%rotation.length; lastDir=-1; renderSlide(idx, -1); }
    function play(){ if (timer) clearInterval(timer); timer = setInterval(next, INTERVAL_SEC*1000); playing=true; }
    function pause(){ if (timer) clearInterval(timer); timer=null; playing=false; }

    // Tlaƒç√≠tka + kl√°vesy
    btnNext.onclick = ()=>{ pause(); next(); };
    btnPrev.onclick = ()=>{ pause(); prev(); };
    btnToggle.onclick = ()=>{ playing ? pause() : (play(), renderSlide(idx,lastDir)); };
    document.addEventListener("keydown", (e)=>{
      if (e.code === "Space"){ e.preventDefault(); btnToggle.click(); }
      if (e.key === "ArrowRight"){ btnNext.click(); }
      if (e.key === "ArrowLeft"){ btnPrev.click(); }
    });

    // === Dotykov√© / drag ovl√°d√°n√≠ (swipe L/R) ===
    (function addSwipe(el){
      let startX=0, startY=0, dx=0, dy=0, dragging=false;
      const THRESH = 60, MAX_ANGLE = 30; // povolit jen vodorovn√©
      const onStart = (x,y)=>{ startX=x; startY=y; dx=dy=0; dragging=true; };
      const onMove  = (x,y)=>{ if(!dragging) return; dx=x-startX; dy=y-startY; };
      const onEnd   = ()=>{
        if(!dragging) return;
        const angle = Math.abs(Math.atan2(dy, dx) * 180/Math.PI);
        if (Math.abs(dx) > THRESH && angle < MAX_ANGLE){
          pause();
          dx<0 ? next() : prev();
        }
        dragging=false;
      };
      // touch
      el.addEventListener("touchstart", e=>{ const t=e.changedTouches[0]; onStart(t.clientX,t.clientY); }, {passive:true});
      el.addEventListener("touchmove",  e=>{ const t=e.changedTouches[0]; onMove(t.clientX,t.clientY); }, {passive:true});
      el.addEventListener("touchend",   ()=> onEnd(), {passive:true});
      // mouse
      el.addEventListener("mousedown", e=> onStart(e.clientX,e.clientY));
      window.addEventListener("mousemove", e=> onMove(e.clientX,e.clientY));
      window.addEventListener("mouseup", onEnd);
    })(stage);

    // Viditelnost
    document.addEventListener("visibilitychange", ()=>{ if (document.hidden) pause(); else if (!timer && playing) play(); });

    // Start
    renderSlide(idx, +1); play();

    /* ====== Pozad√≠ ====== */
    function particles(canvas, {N=48, speed=.32}={}){
      const ctx = canvas.getContext("2d");
      let w=0,h=0, raf=0;
      const dots = Array.from({length:N}, ()=>({x:0,y:0,vx:(Math.random()-.5)*speed,vy:(Math.random()-.5)*speed}));
      function resize(){ w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
      function reset(){ dots.forEach(d=>{ d.x=Math.random()*w; d.y=Math.random()*h; }); }
      function draw(){
        ctx.clearRect(0,0,w,h);
        const grad = ctx.createLinearGradient(0,0,w,h);
        grad.addColorStop(0,"#0b1220"); grad.addColorStop(1,"#0b0f16");
        ctx.fillStyle=grad; ctx.globalAlpha=.94; ctx.fillRect(0,0,w,h); ctx.globalAlpha=1;
        for(let i=0;i<N;i++){
          const a=dots[i]; a.x+=a.vx; a.y+=a.vy;
          if(a.x<0||a.x>w) a.vx*=-1; if(a.y<0||a.y>h) a.vy*=-1;
          for(let j=i+1;j<N;j++){
            const b=dots[j],dx=a.x-b.x,dy=a.y-b.y,d=Math.hypot(dx,dy);
            if(d<120){ ctx.globalAlpha = 1 - d/120; ctx.strokeStyle = "#60a5fa"; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); ctx.globalAlpha=1; }
          }
          ctx.fillStyle="#22d3ee"; ctx.beginPath(); ctx.arc(a.x,a.y,1.2,0,Math.PI*2); ctx.fill();
        }
        raf = requestAnimationFrame(draw);
      }
      addEventListener("resize", resize);
      resize(); reset(); draw();
      return ()=>cancelAnimationFrame(raf);
    }
    particles(document.getElementById("backCanvas"), { N: 48, speed: .32 });
  </script>
</body>
</html>
