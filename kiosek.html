<!doctype html>
<html lang="cs" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grafit — Kiosk rotace karet (bez odkazů)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body { height:100%; }
    .bg-gradient-dark { background: linear-gradient(#070b12,#0a0f18 55%,#090d14); }
    .card { transition: transform 300ms cubic-bezier(.2,.8,.2,1), box-shadow 300ms ease; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    .card .thumb { transform: scale(1.02); transition: transform 600ms cubic-bezier(.22,1,.36,1); }
    .card:hover .thumb { transform: scale(1.04); }

    /* Stage + vrstvení snímků, aby se nezvětšovala výška stránky */
    #stage { position: relative; width: min(1200px,95vw); }
    .slide-layer { position: absolute; inset: 0; }
    .slide-layer.initial { position: static; } /* první slide nastaví výšku stage */

    /* Vodorovné přechody (vpřed i zpět) */
    .slide-enter            { opacity: 0; transform: translateX(40px) scale(.995); }
    .slide-enter-rev        { opacity: 0; transform: translateX(-40px) scale(.995); }
    .slide-enter-active     { opacity: 1; transform: translateX(0)    scale(1);    transition: opacity 450ms ease, transform 450ms ease; }
    .slide-exit             { opacity: 1; transform: translateX(0)    scale(1); }
    .slide-exit-active      { opacity: 0; transform: translateX(-40px) scale(.995); transition: opacity 380ms ease, transform 380ms ease; }
    .slide-exit-active-rev  { opacity: 0; transform: translateX(40px)  scale(.995); transition: opacity 380ms ease, transform 380ms ease; }

    /* 3-řádkové zalomení anotace */
    .clamp-3{
      display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .kiosk-sub { letter-spacing:.01em }

    /* Centrovaní obsahu vůči fixnímu headeru */
    :root{ --header-h: 0px; }
    #shell{ min-height: calc(100vh - var(--header-h)); }
  </style>
</head>
<body class="min-h-screen bg-gradient-dark text-white">

  <canvas id="backCanvas" class="fixed inset-0 w-full h-full"></canvas>

  <!-- FIXNÍ HEADER s ID pro výpočet výšky -->
  <header id="topbar" class="pointer-events-none fixed left-0 right-0 top-0 z-20">
    <div class="mx-auto max-w-[1400px] px-4 xl:px-6 py-4 flex items-center justify-between text-sm text-neutral-300/90">
      <div class="pointer-events-auto rounded-full border border-white/15 bg-black/30 px-3 py-1.5 backdrop-blur">
        Grafit Research Group — slideshow
      </div>
      <div id="status" class="pointer-events-auto rounded-full border border-white/15 bg-black/30 px-3 py-1.5 backdrop-blur">
        ⏵ běží · 15 s
      </div>
    </div>
  </header>

  <!-- SHELL: výška = viewport minus header -->
  <main id="shell" class="relative z-10 flex items-center justify-center px-4">
    <div id="stage" class="touch-pan-y select-none"></div>
  </main>

  <div class="fixed right-4 bottom-4 z-20 flex gap-2">
    <button id="btnPrev" class="rounded-full border border-white/15 bg-black/40 px-3 py-1.5 text-sm hover:bg-white/10">← Předchozí</button>
    <button id="btnToggle" class="rounded-full border border-white/15 bg-black/40 px-3 py-1.5 text-sm hover:bg-white/10">⏸ Pauza</button>
    <button id="btnNext" class="rounded-full border border-white/15 bg-black/40 px-3 py-1.5 text-sm hover:bg-white/10">Další →</button>
  </div>

  <script>
    /* ====== DATA (zkráceno pro ukázku – můžeš vložit celý seznam) ====== */
   const EVENTS = [
      { id:"e-gamejam-2025", title:"GameJam 2025", blurb:"Another installment in our series of traditional game jams! Once again over Easter, this time with a surprise – judges from game studios and major companies.", img:"/assets/projects/majak2.png", href:"https://itch.io/jam/gamejam-fit-2025a", tags:["event","gamejam","community"], date:"Spring 2025" },
      { id:"e-hellofit-2025", title:"HelloFit 2025", blurb:"Part of our traditional freshmen events. We teamed up with Fit++, welcomed new students and invited them to our game design group and the STOH board-game club.", img:"/events/hellofit.jpg", href:"https://www.klubfitpp.cz/events/2025/hello-fit-25/", tags:["event","community","onboarding"], date:"2025" },
      { id:"e-gamejam-2024", title:"GameJam 2024", blurb:"Another traditional jam. Christmas edition with industry judges from game studios and major companies.", img:"/assets/projects/gamejam_2024b_logo.jpg", href:"https://itch.io/jam/gamejam-fit-2024-vanocni", tags:["event","gamejam"], date:"Dec 2024" },
      { id:"e-gexpo-2025", title:"GEXPO 2025", blurb:"Graphics Expo showcasing achievements of our students in game development, VR, and final projects. 60+ participants and a packed evening program.", img:"/assets/projects/gexpo_logo.jpg", href:"events/gexpo/2025", tags:["event","expo","students","vr","games"], date:"2025" },
      { id:"e-researchers-night-2025", title:"ResearchersNight 2025", blurb:"Celebrating 20 years of Researchers' Night in the Czech Republic across 50+ cities.", img:"/assets/projects/nocvedcu.png", href:"https://www.nocvedcu.cz/en", tags:["event","public","research"], date:"26 Sep 2025" },
      { id:"e-grafit-games-studio", title:"Grafit Games Studio", blurb:"Bridging cutting-edge research with creative game development across digital and board games.", img:"/assets/projects/grafitgames_logo.jpg", href:"https://barushe22.itch.io/neckventure", tags:["studio","games","event"], date:"ongoing" }
    ];
    const RESEARCH = [
      { id:"r-politeia21", title:"Politeia 21", blurb:"Interdisciplinary VR project exploring Plato’s theses, ethics and human behavior in a large-scale social simulation.", img:"/assets/projects/politeia.png", href:"https://www.unihack.cz/project/8", tags:["vr","simulation","social","philosophy","research"] },
      { id:"r-dowry-towns", title:"Dowry Towns of Bohemian Queens", blurb:"Projects mapping historical development and digitizing cultural heritage of royal dowry towns; VR reconstructions and archives.", img:"/assets/projects/vennamesta.png", href:"https://www.kralovskavennamesta.cz/", tags:["heritage","mapping","history","vr"], date:"2018–2022" },
      { id:"r-game-design", title:"Game design", blurb:"Research in game design theory: world design, accessibility for impaired users, and creative writing.", img:"/assets/projects/gamedesign.png", href:"/projects/", tags:["games","design","accessibility","writing"] },
      { id:"r-texture-modeling", title:"Texture modeling", blurb:"With the Institute of Information Theory and Automation (CAS), we analyze and model realistic material appearance (BRDF/BTF).", img:"/assets/projects/textures.jpg", href:"http://btf.utia.cas.cz/?brdf_dwn", tags:["materials","brdf","btf","collaboration"] },
      { id:"r-most-city", title:"Most – city that did not disappear", blurb:"Reconstruction of the historic appearance of the city of Most prior to its major redevelopment.", img:"/assets/projects/most.png", href:"https://www.vugtk.cz/en/home-page/", tags:["heritage","reconstruction","city","3d"], date:"2023–2027" },
      { id:"r-tactile-wall", title:"Tactile interfaces: interactive wall", blurb:"Exploration of tactile-specific interfaces in collaboration with MIT, University of Tokyo, initi.org and CAMP.", img:"/assets/projects/intwall.png", href:"https://www.youtube.com/watch?v=3jvmoj7pLZU&ab_channel=IraWinder", tags:["haptics","ui","installation","collaboration"] }
    ];
    const SHOWCASE = [
      { id:"sc-wood-texture-generation", title:"Wood texture generation", blurb:"Plugin for creating artificial wood texture.", img:"/assets/showcase/jechdrevo.png", href:"https://iga.ksi.fit.cvut.cz/bi-pga/b241/3d/jechjose?class=3d", tags:["pga","texture","bachelor"] },
      { id:"sc-ai-texture-to-3d", title:"AI Texture to 3D generation", img:"/assets/showcase/stablegen.jpg", href:"https://stablegen.ai", tags:["pga","ai","texture","3d","bachelor"] },
      { id:"sc-texture-editing", title:"Texture editing", img:"/assets/showcase/svabova.png", href:"https://gitlab.fit.cvut.cz/BI-PGA/stud/svabosa1/blob/master/dokumentace1.adoc", tags:["pga","gimp","content-aware"] },
      { id:"sc-elections-visualisation", title:"Elections visualisation", img:"/assets/showcase/milec.png", href:"https://gitlab.fit.cvut.cz/BI-PGA/stud/milecold/blob/master/dokumentace2.adoc", tags:["pga","visualization","sage","parser"] },
      { id:"sc-edge-detectors", title:"Edge detectors", img:"/assets/showcase/hoskorad.jpg", href:"https://gitlab.fit.cvut.cz/BI-PGA/stud/hoskorad/blob/master/dokumentace1.adoc", tags:["pga","gimp","edge-detection"] },
      { id:"sc-3d-ft-visualisation", title:"3D FT visualisation", img:"/assets/showcase/valko.png", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/valkojo1/tree/master/3D", tags:["pga","blender","fourier","3d"] },
      { id:"sc-parametric-towers", title:"Parametric towers generation", img:"/assets/showcase/trzasmar.jpg", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/trzasmar/blob/master/3D-object_generator/dokumentace3.adoc", tags:["pga","blender","procedural"] },
      { id:"sc-mandelbulb", title:"Mandelbulb", img:"/assets/showcase/svejstil.jpg", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/svejsond/blob/master/3D/dokumentace3.adoc", tags:["pga","blender","fractal"] },
      { id:"sc-linky-animation", title:"Linky animation", img:"/assets/showcase/cvut2.gif", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/spaneada/blob/master/gimp/dokumentace1.md", tags:["pga","gimp","animation"] },
      { id:"sc-edge-detect-material", title:"Edge Detect Material", img:"/assets/showcase/poncaada.png", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/poncaada", tags:["pga","blender","material"] },
      { id:"sc-seam-carving", title:"Seam carving", img:"/assets/showcase/kolemrad.png", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/kolemrad/blob/master/dokumentace1.md", tags:["pga","gimp","seam-carving"] },
      { id:"sc-gallifreyan-translator", title:"Gallifreyan translator", img:"/assets/showcase/kyselova.png", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/kyselba1", tags:["blender","simulation","bachelor"] },
      { id:"sc-blender-snow", title:"Blender Snow", img:"/assets/showcase/kacer.jpg", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/kacervik", tags:["pga","blender","snow"] },
      { id:"sc-decimation", title:"Decimation", img:"/assets/showcase/kvasnica.jpg", href:"https://gitlab.fit.cvut.cz/BI-PGA/b201/kvasnric", tags:["pga","blender","decimation"] },
      { id:"sc-magnificent-7", title:"Magnificent 7", img:"/assets/showcase/img_vhs_1.png", href:"https://youtu.be/SN_Pse347iI", tags:["vhs","unity","game"] },
      { id:"sc-pointless-pointers", title:"Pointless pointers", img:"/assets/showcase/img_vhs_2.png", href:"https://www.youtube.com/watch?v=4u3qrxFuULM&t=1s", tags:["vhs","pixel-art","game"] },
      { id:"sc-strahov-gang", title:"Strahov Gang", img:"/assets/showcase/img_vhs_3.png", href:"https://youtu.be/n1OENc6Fc2M?list=PLXhipPFpvUWH24SDRyFNhCUIuf8zIkM-m", tags:["vhs","unreal","game"] },
      { id:"sc-golf-town", title:"Golf Town", img:"/assets/showcase/img_vhs_4.png", href:"https://www.youtube.com/watch?v=OB7_UmOI_2U&t=6s", tags:["vhs","unity","vr","game"] },
      { id:"sc-poe-ripoff", title:"Path of Exile Ripoff", img:"/assets/showcase/img_vhs_5.png", href:"https://www.youtube.com/watch?v=7P3N3s81QqU&t=20s", tags:["vhs","unity","mmorpg","game"] },
      { id:"sc-ardaestra-magitech", title:"Ardaestra Magitech", img:"/assets/showcase/img_vhs_6.png", href:"https://youtu.be/Zz09tvnLEuo?list=PLXhipPFpvUWH24SDRyFNhCUIuf8zIkM-m", tags:["vhs","unity","rpg","game"] },
      { id:"sc-fitlife", title:"FitLife", img:"/assets/showcase/FitLife.png", href:"https://antik98.github.io/FitLife/", tags:["bachelor","pixel-art","game"] },
      { id:"sc-honza", title:"Honza", img:"/assets/showcase/honzaDetail.png", href:"https://www.youtube.com/watch?v=dhuMuopxlio&list=PLXhipPFpvUWEhSxw79CDOdjFFm5D6b3us&index=4&ab_channel=GrafitCTUFITPrague", tags:["vhs","pixel-art","game"] }
    ];

    /* ====== Nastavení ====== */
    const INTERVAL_SEC = Number(new URLSearchParams(location.search).get("speed")) || 15;
    const SHUFFLE = (new URLSearchParams(location.search).get("shuffle")) === "1";
    const stage = document.getElementById("stage");
    const statusEl = document.getElementById("status");
    const shell = document.getElementById('shell');
    const topbar = document.getElementById('topbar');
    const SWIPE_LEFT_IS_PREV = true; // když true: doleva = předchozí, doprava = další
    const btnPrev  = document.getElementById('btnPrev');
    const btnNext  = document.getElementById('btnNext');
    const btnToggle = document.getElementById('btnToggle');
    const DOTS = Number(new URLSearchParams(location.search).get("dots")) || 148;

    particles(document.getElementById("backCanvas"), { N: DOTS, speed: .32 });

    // Layout: odečíst výšku headeru
    function relayout(){
      const h = topbar?.offsetHeight || 0;
      document.documentElement.style.setProperty('--header-h', h + 'px');
    }
    addEventListener('resize', relayout);
    new ResizeObserver(relayout).observe(topbar);
    relayout();

    // Rotace
    let rotation = [
      ...EVENTS.map(x => ({...x, kind:"event"})),
      ...RESEARCH.map(x => ({...x, kind:"research"})),
      ...SHOWCASE.map(x => ({...x, kind:"showcase"})),
    ];
    if (SHUFFLE) rotation = rotation.sort(()=>Math.random()-.5);

    let idx = 0, timer = null, playing = true, lastDir = 1;
    let firstRenderDone = false;

    const subline = (item) => {
      const t = (item.tags?.length ? "#"+item.tags.slice(0,3).join("  #") : "");
      const d = item.date ? ` · ${item.date}` : "";
      return (t + d).trim();
    };

    // Neklikací karta
    function createCard(item){
      const article = document.createElement("article");
      article.className = "card block rounded-2xl overflow-hidden border border-white/10 bg-gradient-to-b from-neutral-900 to-black cursor-default";

      const aspect = item.kind === "research" ? "aspect-[3/1]" : "aspect-[2/1]";
      const imgBox = document.createElement("div");
      imgBox.className = `relative w-full overflow-hidden ${aspect}`;
      const img = document.createElement("img");
      img.src = item.img; img.alt = item.title; img.loading="eager";
      img.className = "thumb h-full w-full object-cover object-center";
      imgBox.appendChild(img);
      imgBox.appendChild(Object.assign(document.createElement("div"), {className:"absolute inset-0 bg-gradient-to-t from-black/55 to-transparent"}));
      if (item.date){
        const badge = document.createElement("span");
        badge.className = "absolute left-3 top-3 inline-flex items-center gap-1 rounded-full bg-black/60 px-2 py-1 text-xs text-neutral-200 border border-white/10";
        badge.textContent = "📅 " + item.date;
        imgBox.appendChild(badge);
      }
      article.appendChild(imgBox);

      const body = document.createElement("div");
      body.className = "p-5";
      const top = document.createElement("div");
      top.className = "flex items-baseline justify-between";
      const h3 = Object.assign(document.createElement("h3"), {className:"text-2xl font-semibold text-neutral-100", textContent:item.title});
      const kind = Object.assign(document.createElement("span"), {className:"rounded-md border border-white/10 bg-white/5 px-2 py-0.5 text-xs uppercase tracking-wide text-neutral-300", textContent:item.kind});
      top.appendChild(h3); top.appendChild(kind);
      body.appendChild(top);

      const p = Object.assign(document.createElement("p"), {className:"mt-2 text-neutral-300/90 text-base leading-relaxed clamp-3", textContent:(item.blurb||"")});
      body.appendChild(p);

      const small = Object.assign(document.createElement("p"), {className:"kiosk-sub mt-1 text-sm text-neutral-400", textContent:subline(item)});
      body.appendChild(small);

      if ((item.tags||[]).length){
        const tg = Object.assign(document.createElement("div"), {className:"mt-4 flex flex-wrap gap-2"});
        item.tags.forEach(t=>{
          const chip = Object.assign(document.createElement("span"), {className:"text-xs rounded-full border px-2 py-0.5 text-neutral-300 border-neutral-700/80", textContent:"#"+t});
          tg.appendChild(chip);
        });
        body.appendChild(tg);
      }
      article.appendChild(body);
      return article;
    }

    function renderSlide(i, dir=1){
      const item = rotation[(i+rotation.length)%rotation.length];

      // Nová vrstva
      const newWrap = document.createElement("div");
      newWrap.className = (firstRenderDone ? "slide-layer " : "initial ") + (dir===1 ? "slide-enter" : "slide-enter-rev");
      const card = createCard(item);
      newWrap.appendChild(card);
      stage.appendChild(newWrap);

      if (!firstRenderDone) {
        stage.style.height = newWrap.offsetHeight + "px";
        newWrap.classList.remove("initial");
        newWrap.classList.add("slide-layer");
        firstRenderDone = true;
      }

      // Starý slide
      const old = [...stage.children].find(el => el !== newWrap);
      if (old){
        old.classList.add("slide-exit");
        void old.offsetWidth; // reflow
        old.classList.add(dir===1 ? "slide-exit-active" : "slide-exit-active-rev");
        const cleanup = () => { if (old && old.parentNode === stage) stage.removeChild(old); };
        old.addEventListener("transitionend", cleanup, {once:true});
        setTimeout(cleanup, 500);
      }

      // Příjezd nového
      void newWrap.offsetWidth;
      newWrap.classList.add("slide-enter-active");

      statusEl.textContent = (timer ? "⏵ běží" : "⏸ pauza") + " · " + INTERVAL_SEC + " s · " + ( (i%rotation.length)+1 ) + "/" + rotation.length;
      document.title = `${item.title} — Grafit kiosk`;
    }

    function next(){ idx = (idx+1)%rotation.length; renderSlide(idx, +1); }
    function prev(){ idx = (idx-1+rotation.length)%rotation.length; renderSlide(idx, -1); }

    function play(){ if (timer) clearInterval(timer); timer = setInterval(next, INTERVAL_SEC*1000); }
    function pause(){ if (timer) clearInterval(timer); timer=null; }

    // Ovládání
    btnNext.onclick = ()=>{ pause(); next(); };
    btnPrev.onclick = ()=>{ pause(); prev(); };
    btnToggle.onclick = ()=>{ timer ? pause() : play(); statusEl.textContent = (timer ? "⏵ běží" : "⏸ pauza") + " · " + INTERVAL_SEC + " s"; };
    document.addEventListener("keydown", (e)=>{
      if (e.code === "Space"){ e.preventDefault(); btnToggle.click(); }
      if (e.key === "ArrowRight"){ btnNext.click(); }
      if (e.key === "ArrowLeft"){ btnPrev.click(); }
    });

    // Dotyk/drag — swipe L/R
    (function addSwipe(el){
      let startX=0, startY=0, dx=0, dy=0, dragging=false;
      const THRESH = 60, MAX_ANGLE = 30;
      const onStart = (x,y)=>{ startX=x; startY=y; dx=dy=0; dragging=true; };
      const onMove  = (x,y)=>{ if(!dragging) return; dx=x-startX; dy=y-startY; };
      const onEnd   = ()=>{
        if(!dragging) return;
        const angle = Math.abs(Math.atan2(dy, dx) * 180/Math.PI);
        if (Math.abs(dx) > THRESH && angle < MAX_ANGLE){
  pause();
  if (dx < 0) { // swipe doleva
    SWIPE_LEFT_IS_PREV ? prev() : next();
  } else {      // swipe doprava
    SWIPE_LEFT_IS_PREV ? next() : prev();
  }
}

        dragging=false;
      };
      // touch
      el.addEventListener("touchstart", e=>{ const t=e.changedTouches[0]; onStart(t.clientX,t.clientY); }, {passive:true});
      el.addEventListener("touchmove",  e=>{ const t=e.changedTouches[0]; onMove(t.clientX,t.clientY); }, {passive:true});
      el.addEventListener("touchend",   ()=> onEnd(), {passive:true});
      // mouse
      el.addEventListener("mousedown", e=> onStart(e.clientX,e.clientY));
      window.addEventListener("mousemove", e=> onMove(e.clientX,e.clientY));
      window.addEventListener("mouseup", onEnd);
    })(stage);

    // Viditelnost
    document.addEventListener("visibilitychange", ()=>{ if (document.hidden) pause(); else if (!timer) play(); });

    // Start
    renderSlide(idx, +1); play();

    /* ====== Pozadí ====== */
    function particles(canvas, {N=48, speed=.32}={}){
      const ctx = canvas.getContext("2d");
      let w=0,h=0, raf=0;
      const dots = Array.from({length:N}, ()=>({x:0,y:0,vx:(Math.random()-.5)*speed,vy:(Math.random()-.5)*speed}));
      function resize(){ w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
      function reset(){ dots.forEach(d=>{ d.x=Math.random()*w; d.y=Math.random()*h; }); }
      function draw(){
        ctx.clearRect(0,0,w,h);
        const grad = ctx.createLinearGradient(0,0,w,h);
        grad.addColorStop(0,"#0b1220"); grad.addColorStop(1,"#0b0f16");
        ctx.fillStyle=grad; ctx.globalAlpha=.94; ctx.fillRect(0,0,w,h); ctx.globalAlpha=1;
        for(let i=0;i<N;i++){
          const a=dots[i]; a.x+=a.vx; a.y+=a.vy;
          if(a.x<0||a.x>w) a.vx*=-1; if(a.y<0||a.y>h) a.vy*=-1;
          for(let j=i+1;j<N;j++){
            const b=dots[j],dx=a.x-b.x,dy=a.y-b.y,d=Math.hypot(dx,dy);
            if(d<120){ ctx.globalAlpha = 1 - d/120; ctx.strokeStyle = "#60a5fa"; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); ctx.globalAlpha=1; }
          }
          ctx.fillStyle="#22d3ee"; ctx.beginPath(); ctx.arc(a.x,a.y,1.2,0,Math.PI*2); ctx.fill();
        }
        raf = requestAnimationFrame(draw);
      }
      addEventListener("resize", resize);
      resize(); reset(); draw();
      return ()=>cancelAnimationFrame(raf);
    }
    particles(document.getElementById("backCanvas"), { N: 48, speed: .32 });
  </script>
</body>
</html>
