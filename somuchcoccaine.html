<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>V√°noƒçn√≠ spo≈ôiƒç ‚Äì snƒõ≈æen√≠, girlandy, n√°mraza, hexagon</title>
  <style>
    html, body { margin:0; height:100%; background:#0b1220; overflow:hidden; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
    #c { position:fixed; inset:0; display:block; }
    .ui { position:fixed; right:16px; top:16px; display:flex; flex-wrap:wrap; gap:8px; z-index:10; }
    .btn, .chip { color:#fff; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.25); border-radius:12px; padding:8px 10px; font-size:12px; backdrop-filter: blur(6px); cursor:pointer; user-select:none; }
    .btn:hover { background:rgba(255,255,255,.16); }
    .chip { display:flex; align-items:center; gap:6px; }
    .hint { position:fixed; left:50%; transform:translateX(-50%); top:72px; color:#fff; background:rgba(0,0,0,.35); padding:8px 12px; border-radius:14px; font-size:13px; z-index:9; backdrop-filter: blur(6px); }
    .counter { min-width:24px; text-align:center; }
    a { color:#cde3ff; }
  </style>
</head>
<body>
  <canvas id="c"></canvas>

  <div class="ui" id="ui">
    <div class="btn" id="toggleXmas">V√°noƒçn√≠ m√≥d: Zap</div>
    <div class="btn" id="toggleSound">Zvuk: Zap</div>
    <div class="chip">
      <span>Girlandy</span>
      <div class="btn" id="lessG">‚àí</div>
      <span class="counter" id="gCount">3</span>
      <div class="btn" id="moreG">Ôºã</div>
    </div>
    <div class="btn" id="toggleIce">N√°mraza: Zap</div>
    <div class="btn" id="toggleHex">Hexagon: Zap</div>
  </div>

  <div class="hint" id="hint">Obƒças m√≠sto vloƒçky pad√° <b>hexagon Grafitu</b> ‚Äî klik a üí• oh≈àostroj. Klik kamkoli tak√© proraz√≠ <b>n√°mrazu</b>. ‚ùÑÔ∏è‚ú®</div>

  <script>
  (function(){
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    let width=0, height=0, dpr=1;

    // user toggles
    let xmasOn = true;
    let soundOn = true;
    let iceOn = true;
    let hexOn = true;
    let garlandCount = 3;

    // audio
    let actx = null; // created on first click
    function ensureAudio(){ if(!actx){ const Ctx = window.AudioContext || window.webkitAudioContext; if(Ctx) actx = new Ctx(); } }

    // entities
    const flakes=[], special=[], logos=[], dust=[], sparks=[], shards=[], flashes=[], shockwaves=[];
    const garlands=[]; // {bulbs:[], yFunc}
    const targetFlakes=300; const specialRate=0.12; const logoRate=0.025;

    // frost layers
    let frostPatternCanvas, frostPatternCtx, frostCanvas, frostCtx, frostAlpha=0; const iceHoles=[];

    // utils
    function rand(a,b){ return Math.random()*(b-a)+a; }
    function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

    function resize(){
      dpr = Math.min(window.devicePixelRatio||1, 2);
      width = Math.floor(innerWidth * dpr);
      height = Math.floor(innerHeight * dpr);
      canvas.width = width; canvas.height = height;
      canvas.style.width = innerWidth+'px'; canvas.style.height = innerHeight+'px';
      layoutGarlands();
      buildFrostLayers();
    }

    // classes
    class Flake{ constructor(x,y,r){ this.x=x; this.y=y; this.r=r; this.vy=rand(8,20)*(0.4+r*0.1); this.drift=rand(8,18); this.phase=Math.random()*Math.PI*2; }
      update(dt){ this.y += this.vy*dt; this.x += Math.sin(this.phase + this.y*0.01)*this.drift*dt; if(this.y-this.r>height){ this.y=-10; this.x=rand(0,width);} if(this.x<-20) this.x=width+20; if(this.x>width+20) this.x=-20; }
      draw(){ ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.fill(); }
    }
    class BigFlake{ constructor(x,y,r){ this.x=x; this.y=y; this.r=r; this.vy=rand(20,35); this.spin=rand(-0.6,0.6); this.a=rand(0,Math.PI*2); this.swayPhase=rand(0,Math.PI*2); this.swayAmp=rand(10,28);} 
      update(dt){ this.y+=this.vy*dt; this.a+=this.spin*dt; this.x += Math.sin(this.swayPhase + this.y*0.015)*this.swayAmp*dt; }
      isOff(){ return this.y - this.r > height + 40; }
      hit(px,py){ const dx=px-this.x, dy=py-this.y; return dx*dx+dy*dy <= (this.r+6)*(this.r+6); }
      draw(){ ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.a); ctx.lineWidth=Math.max(1,this.r*0.08); ctx.lineJoin='round'; ctx.strokeStyle='rgba(255,255,255,0.95)'; for(let i=0;i<6;i++){ drawArm(this.r,(Math.PI*2*i)/6); } ctx.restore(); }
    }
    function drawArm(r,rot){ ctx.save(); ctx.rotate(rot); ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0,-r); const t1=-r*0.55, t2=-r*0.8; ctx.moveTo(0,t1); ctx.lineTo(r*0.22,t1+r*0.18); ctx.moveTo(0,t1); ctx.lineTo(-r*0.22,t1+r*0.18); ctx.moveTo(0,t2); ctx.lineTo(r*0.18,t2+r*0.16); ctx.moveTo(0,t2); ctx.lineTo(-r*0.18,t2+r*0.16); ctx.stroke(); ctx.restore(); }

    class Dust{ constructor(x,y){ this.x=x; this.y=y; this.vx=rand(-60,60); this.vy=rand(-80,-10); this.max=rand(0.9,1.8); this.t=this.max; }
      update(dt){ this.vy+=120*dt; this.x+=this.vx*dt; this.y+=this.vy*dt; this.t-=dt; }
      draw(){ const a=Math.max(0,this.t/this.max); ctx.fillStyle=`rgba(255,255,255,${0.9*a})`; ctx.fillRect(this.x,this.y,1.5,1.5); }
      dead(){ return this.t<=0; }
    }

    class Spark{ constructor(x,y,speed){ this.x=x; this.y=y; this.px=x; this.py=y; const a=rand(0,Math.PI*2); this.vx=Math.cos(a)*speed; this.vy=Math.sin(a)*speed - rand(0,40); this.max=rand(0.35,0.9); this.t=this.max; }
      update(dt){ this.px=this.x; this.py=this.y; this.vx*=0.985; this.vy*=0.985; this.vy+=80*dt; this.x+=this.vx*dt; this.y+=this.vy*dt; this.t-=dt; }
      draw(){ const a=Math.max(0,this.t/this.max); ctx.strokeStyle=`rgba(255,220,150,${0.8*a})`; ctx.lineWidth=Math.max(1,1.2*dpr); ctx.beginPath(); ctx.moveTo(this.px,this.py); ctx.lineTo(this.x,this.y); ctx.stroke(); ctx.fillStyle=`rgba(255,255,255,${0.7*a})`; ctx.fillRect(this.x-0.7,this.y-0.7,1.4,1.4); }
      dead(){ return this.t<=0; }
    }

    class BurstSpark extends Spark{ constructor(x,y,speed,color){ super(x,y,speed); this.color=color; } draw(){ const a=Math.max(0,this.t/this.max); ctx.strokeStyle=this.color.replace('ALPHA',(0.85*a).toFixed(3)); ctx.lineWidth=Math.max(1,1.4*dpr); ctx.beginPath(); ctx.moveTo(this.px,this.py); ctx.lineTo(this.x,this.y); ctx.stroke(); } }

    const FW_COLORS=[ 'rgba(255,120,120,ALPHA)','rgba(255,220,120,ALPHA)','rgba(120,220,255,ALPHA)','rgba(140,255,160,ALPHA)','rgba(220,140,255,ALPHA)','rgba(255,255,255,ALPHA)'];
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]]; } return a; }

    class Flash{ constructor(x,y){ this.x=x; this.y=y; this.r=10; this.max=0.25; this.t=this.max; } update(dt){ this.r+=900*dt; this.t-=dt; } draw(){ const a=Math.max(0,this.t/this.max); const g=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.r); g.addColorStop(0,`rgba(255,255,255,${0.8*a})`); g.addColorStop(1,'transparent'); ctx.save(); ctx.globalCompositeOperation='lighter'; ctx.fillStyle=g; ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fill(); ctx.restore(); } dead(){ return this.t<=0; } }
    class Shock{ constructor(x,y){ this.x=x; this.y=y; this.r=0; this.max=0.8; this.t=this.max; } update(dt){ this.r+=420*dt; this.t-=dt; } draw(){ const a=Math.max(0,this.t/this.max); ctx.save(); ctx.globalAlpha=0.35*a; ctx.strokeStyle=`rgba(255,255,255,${0.8*a})`; ctx.lineWidth=Math.max(1.5,2*dpr); ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.stroke(); ctx.restore(); } dead(){ return this.t<=0; } }

    function firework(x,y){ const N=(200+Math.random()*120)|0; const base=rand(180,360); const pal=shuffle(FW_COLORS.slice()).slice(0,3); for(let i=0;i<N;i++){ const col=pal[i%pal.length]; const s=base*(0.7+Math.random()*0.6); sparks.push(new BurstSpark(x,y,s,col)); } flashes.push(new Flash(x,y)); shockwaves.push(new Shock(x,y)); for(let i=0;i<80;i++) dust.push(new Dust(x+rand(-2,2), y+rand(-2,2))); }

    // Hexagon logo
    class HexLogo{ constructor(x,y,r){ this.x=x; this.y=y; this.r=r; this.vy=rand(26,40); this.a=rand(0,Math.PI*2); this.va=rand(-0.8,0.8); this.sway=rand(12,22); this.phase=rand(0,Math.PI*2);} update(dt){ this.y+=this.vy*dt; this.a+=this.va*dt; this.x+=Math.sin(this.phase+this.y*0.012)*this.sway*dt; } isOff(){ return this.y - this.r > height + 50; } hit(px,py){ const dx=px-this.x, dy=py-this.y; return dx*dx+dy*dy <= (this.r+6)*(this.r+6); } draw(){ ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.a); const R=this.r, r=R*0.88; const g=ctx.createRadialGradient(0,0,0,0,0,R*2.6); g.addColorStop(0,'rgba(160,200,255,0.25)'); g.addColorStop(1,'transparent'); ctx.globalCompositeOperation='lighter'; ctx.fillStyle=g; ctx.beginPath(); ctx.arc(0,0,R*2.6,0,Math.PI*2); ctx.fill(); ctx.globalCompositeOperation='source-over'; hexPath(R); ctx.lineWidth=Math.max(2,R*0.12); ctx.strokeStyle='#fff'; ctx.stroke(); hexPath(r); const ig=ctx.createLinearGradient(-r,-r,r,r); ig.addColorStop(0,'#87b5ff'); ig.addColorStop(1,'#d3e5ff'); ctx.fillStyle=ig; ctx.fill(); ctx.restore(); } }
    function hexPath(R){ ctx.beginPath(); for(let i=0;i<6;i++){ const ang=Math.PI/6 + i*Math.PI/3; const x=Math.cos(ang)*R, y=Math.sin(ang)*R; if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);} ctx.closePath(); }

    // Xmas bulbs
    const COLORS=[ ['rgb(255,78,78)','rgba(255,78,78,0.9)'], ['rgb(255,214,67)','rgba(255,214,67,0.9)'], ['rgb(67,192,255)','rgba(67,192,255,0.9)'], ['rgb(120,255,120)','rgba(120,255,120,0.9)'], ['rgb(194,120,255)','rgba(194,120,255,0.9)'] ];
    class Bulb{ constructor(x,y){ this.x=x; this.y=y; this.size=rand(6,9)*Math.max(1,dpr*0.9); this.phase=rand(0,Math.PI*2); this.speed=rand(1.2,2.2); const col=COLORS[(Math.random()*COLORS.length)|0]; this.fill=col[0]; this.glow=col[1]; }
      draw(t){ const flick=0.55 + 0.45*Math.max(0, Math.sin(this.phase + t*this.speed)); if(xmasOn && Math.random()<0.25*(1+flick)*0.016){ if(Math.random()<0.35) sparkBurst(this.x,this.y,(rand(4,9))|0); }
        const glowR=this.size*5.2; const rg=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,glowR); rg.addColorStop(0,this.glow.replace('0.9',(0.72*flick).toFixed(3))); rg.addColorStop(1,'transparent'); ctx.save(); ctx.globalCompositeOperation='lighter'; ctx.fillStyle=rg; ctx.beginPath(); ctx.arc(this.x,this.y,glowR,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=this.size*2.2; ctx.shadowColor=this.glow; ctx.fillStyle=this.fill; ctx.beginPath(); ctx.ellipse(this.x,this.y,this.size*0.7,this.size,0,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0; ctx.fillStyle='#2a3b48'; ctx.fillRect(this.x-this.size*0.5, this.y-this.size*1.2, this.size, this.size*0.35); ctx.restore(); }
    }
    function sparkBurst(x,y,n){ for(let i=0;i<n;i++) sparks.push(new Spark(x+rand(-1.5,1.5), y+rand(-1.5,1.5), rand(60,160))); }

    function layoutGarlands(){ garlands.length=0; const cnt=clamp(garlandCount|0,1,6); for(let i=0;i<cnt;i++){ const frac = cnt===1 ? 0.5 : i/(cnt-1); const baseY = height*(0.12 + 0.72*frac); const amp=(18+10*Math.sin(i*1.7))*dpr; const phase=i*Math.PI/5; const step=Math.max(58,(width/22)|0); const bulbs=[]; for(let x=step*0.5; x<width; x+=step){ const y = baseY + Math.sin((x/width)*Math.PI*2 + phase)*amp; bulbs.push(new Bulb(x,y)); } const yFunc = x=> baseY + Math.sin((x/width)*Math.PI*2 + phase)*amp; garlands.push({bulbs,yFunc}); } }
    function drawGarlandWire(yFunc){ ctx.save(); ctx.lineWidth=Math.max(1.5,2.0*dpr); ctx.strokeStyle='#2a3b48'; ctx.beginPath(); for(let x=0; x<=width; x+=8){ const y=yFunc(x); if(x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);} ctx.stroke(); ctx.restore(); }
    function drawGarlands(t){ for(const g of garlands){ drawGarlandWire(g.yFunc); for(let i=0;i<g.bulbs.length;i++) g.bulbs[i].draw(t*(1+i*0.002)); } }

    // Frost
    class IceHole{ constructor(x,y){ this.x=x; this.y=y; this.r=6; this.vr=rand(140,260); this.max=rand(0.9,1.6); this.t=this.max; } update(dt){ this.r+=this.vr*dt; this.vr*=0.98; this.t-=dt; } dead(){ return this.t<=0; } }
    class IceShard{ constructor(x,y){ this.x=x; this.y=y; const sp=rand(80,200); const ang=rand(0,Math.PI*2); this.vx=Math.cos(ang)*sp; this.vy=Math.sin(ang)*sp - rand(0,50); this.a=rand(0,Math.PI*2); this.va=rand(-6,6); this.len=rand(6,16); this.max=rand(0.5,1.2); this.t=this.max; } update(dt){ this.vx*=0.985; this.vy=this.vy*0.985 + 120*dt; this.x+=this.vx*dt; this.y+=this.vy*dt; this.a+=this.va*dt; this.t-=dt; } draw(){ const k=Math.max(0,this.t/this.max); ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.a); ctx.strokeStyle=`rgba(200,230,255,${0.9*k})`; ctx.lineWidth=Math.max(1,1.1*dpr); ctx.beginPath(); ctx.moveTo(-this.len*0.5,0); ctx.lineTo(this.len*0.5,0); ctx.stroke(); ctx.restore(); } dead(){ return this.t<=0; } }

    function buildFrostLayers(){ frostPatternCanvas=document.createElement('canvas'); frostPatternCanvas.width=width; frostPatternCanvas.height=height; frostPatternCtx=frostPatternCanvas.getContext('2d'); frostPatternCtx.clearRect(0,0,width,height); frostPatternCtx.globalCompositeOperation='lighter'; for(let i=0;i<1200;i++){ const x=rand(0,width), y=rand(0,height), len=rand(4,18), ang=rand(0,Math.PI*2); frostPatternCtx.strokeStyle=`rgba(210,235,255,${rand(0.03,0.08)})`; frostPatternCtx.lineWidth=rand(0.6,1.2); frostPatternCtx.beginPath(); frostPatternCtx.moveTo(x-Math.cos(ang)*len*0.5, y-Math.sin(ang)*len*0.5); frostPatternCtx.lineTo(x+Math.cos(ang)*len*0.5, y+Math.sin(ang)*len*0.5); frostPatternCtx.stroke(); } frostPatternCtx.globalCompositeOperation='source-over'; for(let i=0;i<10;i++){ const r=Math.max(width,height)*rand(0.4,0.9); const cx=rand(-width*0.2,width*1.2); const cy=rand(-height*0.2,height*0.2); const g=frostPatternCtx.createRadialGradient(cx,cy,0,cx,cy,r); g.addColorStop(0,'rgba(190,220,255,0.15)'); g.addColorStop(1,'transparent'); frostPatternCtx.fillStyle=g; frostPatternCtx.beginPath(); frostPatternCtx.arc(cx,cy,r,0,Math.PI*2); frostPatternCtx.fill(); } frostCanvas=document.createElement('canvas'); frostCanvas.width=width; frostCanvas.height=height; frostCtx=frostCanvas.getContext('2d'); frostCtx.clearRect(0,0,width,height); }
    function drawFrost(dt){ const target = iceOn ? 0.65 : 0; const rate=0.15; frostAlpha += (target - frostAlpha) * Math.min(1, rate*dt*60); if(frostAlpha<0.01) return; frostCtx.clearRect(0,0,width,height); frostCtx.globalAlpha=frostAlpha; frostCtx.drawImage(frostPatternCanvas,0,0); if(iceHoles.length){ frostCtx.save(); frostCtx.globalCompositeOperation='destination-out'; for(let i=iceHoles.length-1;i>=0;i--){ const h=iceHoles[i]; const rg=frostCtx.createRadialGradient(h.x,h.y, h.r*0.6, h.x,h.y,h.r); rg.addColorStop(0,'rgba(255,255,255,1)'); rg.addColorStop(1,'rgba(255,255,255,0)'); frostCtx.fillStyle=rg; frostCtx.beginPath(); frostCtx.arc(h.x,h.y,h.r,0,Math.PI*2); frostCtx.fill(); h.update(dt); if(h.dead()) iceHoles.splice(i,1); } frostCtx.restore(); } ctx.drawImage(frostCanvas,0,0); }
    function breakIce(px,py){ iceHoles.push(new IceHole(px,py)); for(let i=0;i<((rand(30,60))|0);i++) shards.push(new IceShard(px,py)); if(Math.random()<0.6) sparkBurst(px,py, (rand(10,20))|0); }

    function drawBg(){ const g=ctx.createLinearGradient(0,0,0,height); g.addColorStop(0,'#0b1220'); g.addColorStop(1,'#162943'); ctx.fillStyle=g; ctx.fillRect(0,0,width,height); ctx.globalAlpha=0.08; for(let i=0;i<3;i++){ const cx=Math.random()*width, cy=Math.random()*height, r=Math.random()*200+120; const rg=ctx.createRadialGradient(cx,cy,0,cx,cy,r); rg.addColorStop(0,'#fff'); rg.addColorStop(1,'transparent'); ctx.fillStyle=rg; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fill(); } ctx.globalAlpha=1; }

    function addFlake(){ const r=Math.pow(Math.random(),2)*2.2+0.6; flakes.push(new Flake(rand(0,width), -10, r)); }
    function addSpecial(){ const r=rand(16,30); special.push(new BigFlake(rand(r+10, width-r-10), -40, r)); }
    function addLogo(){ const r=rand(20,34); logos.push(new HexLogo(rand(r+12, width-r-12), -50, r)); }

    function sparkBurst(x,y,n){ for(let i=0;i<n;i++) sparks.push(new Spark(x+rand(-1.5,1.5), y+rand(-1.5,1.5), rand(60,160))); }

    function bell(panNorm){ if(!soundOn||!actx) return; const now=actx.currentTime; const master=actx.createGain(); master.gain.setValueAtTime(0.0001,now); master.gain.exponentialRampToValueAtTime(0.8, now+0.01); master.gain.exponentialRampToValueAtTime(0.0001, now+1.5); let pan = actx.createStereoPanner? actx.createStereoPanner():null; if(pan) pan.pan.setValueAtTime(clamp(panNorm,-1,1), now); (pan? master.connect(pan):master).connect(actx.destination); const base=[659.26,783.99,880,987.77,1046.5]; const f0=base[(Math.random()*base.length)|0]*rand(0.98,1.02); part(1.0,0.6,1.2,'sine'); part(2.41,0.25,1.0,'sine'); part(3.79,0.15,0.9,'triangle'); part(5.2,0.07,0.6,'triangle'); const click=actx.createOscillator(); const cg=actx.createGain(); click.type='square'; click.frequency.setValueAtTime(f0*1.5, now); cg.gain.setValueAtTime(0.12, now); cg.gain.exponentialRampToValueAtTime(0.0001, now+0.08); click.connect(cg).connect(master); click.start(now); click.stop(now+0.09); function part(mul,g0,dec,type){ const o=actx.createOscillator(); o.type=type; o.frequency.setValueAtTime(f0*mul, now); const g=actx.createGain(); g.gain.setValueAtTime(g0, now); g.gain.exponentialRampToValueAtTime(0.0001, now+dec); o.connect(g).connect(master); o.start(now); o.stop(now+dec);} }

    // input
    canvas.addEventListener('pointerdown', (e)=>{ ensureAudio(); document.getElementById('hint').style.display='none'; const rect=canvas.getBoundingClientRect(); const px=(e.clientX-rect.left)*dpr; const py=(e.clientY-rect.top)*dpr; for(let i=logos.length-1;i>=0;i--){ const L=logos[i]; if(L.hit(px,py)){ firework(L.x,L.y); breakIce(L.x,L.y); logos.splice(i,1); return; } }
      let hit=false; for(let i=special.length-1;i>=0;i--){ const f=special[i]; if(f.hit(px,py)){ for(let k=0;k<((60+f.r*2)|0);k++) dust.push(new Dust(f.x+rand(-2,2), f.y+rand(-2,2))); const pan=(px/width)*2-1; bell(pan); sparkBurst(f.x,f.y, ((60+f.r*3)|0)); breakIce(f.x,f.y); special.splice(i,1); hit=true; break; } } if(!hit) breakIce(px,py); });

    // loop
    let last=performance.now(), elapsed=0, running=true;
    function loop(now){ if(!running) return; const dt=Math.min(0.05, (now-last)/1000); last=now; elapsed+=dt; while(flakes.length<targetFlakes) addFlake(); if(Math.random()<specialRate*dt) addSpecial(); if(hexOn && Math.random()<logoRate*dt) addLogo(); for(let i=0;i<flakes.length;i++) flakes[i].update(dt); for(let i=special.length-1;i>=0;i--){ special[i].update(dt); if(special[i].isOff()) special.splice(i,1); } for(let i=logos.length-1;i>=0;i--){ logos[i].update(dt); if(logos[i].isOff()) logos.splice(i,1); } for(let i=dust.length-1;i>=0;i--){ dust[i].update(dt); if(dust[i].dead()) dust.splice(i,1);} for(let i=sparks.length-1;i>=0;i--){ sparks[i].update(dt); if(sparks[i].dead()) sparks.splice(i,1);} for(let i=shards.length-1;i>=0;i--){ shards[i].update(dt); if(shards[i].dead()) shards.splice(i,1);} for(let i=flashes.length-1;i>=0;i--){ flashes[i].update(dt); if(flashes[i].dead()) flashes.splice(i,1);} for(let i=shockwaves.length-1;i>=0;i--){ shockwaves[i].update(dt); if(shockwaves[i].dead()) shockwaves.splice(i,1);} drawBg(); if(xmasOn) drawGarlands(elapsed); for(let i=0;i<flakes.length;i++) flakes[i].draw(); for(let i=0;i<special.length;i++) special[i].draw(); for(let i=0;i<logos.length;i++) logos[i].draw(); for(let i=0;i<dust.length;i++) dust[i].draw(); if(flashes.length||shockwaves.length||sparks.length){ ctx.save(); for(let i=0;i<flashes.length;i++) flashes[i].draw(); ctx.globalCompositeOperation='lighter'; for(let i=0;i<sparks.length;i++) sparks[i].draw(); ctx.restore(); for(let i=0;i<shockwaves.length;i++) shockwaves[i].draw(); } drawFrost(dt); if(shards.length){ ctx.save(); ctx.globalCompositeOperation='lighter'; for(let i=0;i<shards.length;i++) shards[i].draw(); ctx.restore(); } if(xmasOn && Math.random()<0.02) sparkBurst(rand(0,width), rand(height*0.05, height*0.2), (rand(3,6))|0); if(sparks.length>3000) sparks.splice(0, sparks.length-3000); if(shards.length>1500) shards.splice(0, shards.length-1500); requestAnimationFrame(loop); }

    // visibility
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden){ running=false; } else { running=true; last=performance.now(); requestAnimationFrame(loop);} });

    // UI
    document.getElementById('toggleXmas').onclick=()=>{ xmasOn=!xmasOn; document.getElementById('toggleXmas').textContent = 'V√°noƒçn√≠ m√≥d: ' + (xmasOn?'Zap':'Vyp'); };
    document.getElementById('toggleSound').onclick=()=>{ soundOn=!soundOn; if(soundOn) ensureAudio(); document.getElementById('toggleSound').textContent = 'Zvuk: ' + (soundOn?'Zap':'Vyp'); };
    document.getElementById('toggleIce').onclick=()=>{ iceOn=!iceOn; document.getElementById('toggleIce').textContent = 'N√°mraza: ' + (iceOn?'Zap':'Vyp'); };
    document.getElementById('toggleHex').onclick=()=>{ hexOn=!hexOn; document.getElementById('toggleHex').textContent = 'Hexagon: ' + (hexOn?'Zap':'Vyp'); };
    document.getElementById('lessG').onclick=()=>{ garlandCount=Math.max(1, garlandCount-1); document.getElementById('gCount').textContent=garlandCount; layoutGarlands(); };
    document.getElementById('moreG').onclick=()=>{ garlandCount=Math.min(6, garlandCount+1); document.getElementById('gCount').textContent=garlandCount; layoutGarlands(); };

    // start
    resize(); window.addEventListener('resize', resize); requestAnimationFrame(loop);
  })();
  </script>
</body>
</html>
