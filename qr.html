<!doctype html>
<html lang="cs" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Studio — Generátor (PNG/SVG)</title>
  <meta name="description" content="Jednoduchý offline generátor QR kódů s logem uprostřed. Stáhne PNG i SVG." />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 + ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel pro JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- QRCode knihovna -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
</head>
<body class="bg-zinc-950 text-zinc-100">
  <div id="app" class="min-h-screen"></div>

  <script type="text/babel" data-presets="react">
    const { useEffect, useRef, useState } = React;

    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x + rr, y);
      ctx.arcTo(x + w, y, x + w, y + h, rr);
      ctx.arcTo(x + w, y + h, x, y + h, rr);
      ctx.arcTo(x, y + h, x, y, rr);
      ctx.arcTo(x, y, x + w, y, rr);
      ctx.closePath();
    }

    function safeFilename(s){
      return (s || 'qr').replace(/[^a-z0-9]+/gi,'-').slice(0,40).toLowerCase();
    }

    function QRStudio(){
      const [text, setText] = useState('https://grafitctu.github.io/');
      const [size, setSize] = useState(512);
      const [margin, setMargin] = useState(4);
      const [ecc, setEcc] = useState('H');
      const [fg, setFg] = useState('#000000');
      const [bg, setBg] = useState('#ffffff');
      const [logo, setLogo] = useState(null);
      const [logoScale, setLogoScale] = useState(0.2);
      const [logoRound, setLogoRound] = useState(16);
      const [svgMarkup, setSvgMarkup] = useState('');
      const canvasRef = useRef(null);

      async function drawQR(){
        const canvas = canvasRef.current;
        if(!canvas) return;
        await QRCode.toCanvas(canvas, text || '', {
          errorCorrectionLevel: ecc,
          margin,
          color: { dark: fg, light: bg },
          width: size,
          scale: 1,
        });
        if(logo){
          const ctx = canvas.getContext('2d');
          const img = new Image();
          img.onload = () => {
            const w = canvas.width * logoScale;
            const h = w;
            const x = (canvas.width - w)/2;
            const y = (canvas.height - h)/2;
            const r = Math.min(logoRound, w/2, h/2);
            ctx.save();
            roundRect(ctx, x-8, y-8, w+16, h+16, r+8);
            ctx.fillStyle = bg;
            ctx.fill();
            roundRect(ctx, x, y, w, h, r);
            ctx.clip();
            ctx.drawImage(img, x, y, w, h);
            ctx.restore();
          };
          img.src = logo;
        }
      }

      async function buildSVG(){
        const svg = await QRCode.toString(text || '', {
          type: 'svg',
          errorCorrectionLevel: ecc,
          margin,
          color: { dark: fg, light: bg },
          width: size,
          scale: 1,
        });
        setSvgMarkup(svg);
      }

      useEffect(()=>{ drawQR(); buildSVG(); }, [text,size,margin,ecc,fg,bg,logo,logoScale,logoRound]);

      function onPickLogo(e){
        const f = e.target.files?.[0];
        if(!f) return;
        const reader = new FileReader();
        reader.onload = () => setLogo(reader.result);
        reader.readAsDataURL(f);
      }

      function downloadPNG(){
        const canvas = canvasRef.current; if(!canvas) return;
        const a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = `qr-${safeFilename(text)}.png`;
        a.click();
      }

      function downloadSVG(){
        const blob = new Blob([svgMarkup], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `qr-${safeFilename(text)}.svg`; a.click();
        URL.revokeObjectURL(url);
      }

      function reset(){
        setText(''); setFg('#000000'); setBg('#ffffff'); setEcc('H'); setMargin(4); setSize(512);
        setLogo(null); setLogoRound(16); setLogoScale(0.2);
      }

      return (
        <div className="min-h-screen bg-zinc-950 text-zinc-100">
          <div className="mx-auto max-w-7xl px-4 py-8">
            <h1 className="text-2xl font-semibold mb-4">QR Studio</h1>
            <textarea value={text} onChange={e=>setText(e.target.value)} className="w-full rounded px-2 py-1 text-black"/>
            <div className="mt-3 flex gap-2">
              <button onClick={downloadPNG} className="px-4 py-2 bg-indigo-600 rounded">Stáhnout PNG</button>
              <button onClick={downloadSVG} className="px-4 py-2 bg-indigo-600 rounded">Stáhnout SVG</button>
              <button onClick={reset} className="px-4 py-2 bg-gray-700 rounded">Reset</button>
            </div>
            <div className="mt-4">
              <canvas ref={canvasRef} width={size} height={size} className="border rounded"/>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(<QRStudio />);
  </script>
</body>
</html>
