<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Studio ‚Äî ƒçist√Ω JS (PNG/SVG)</title>
  <meta name="description" content="Offline gener√°tor QR k√≥d≈Ø s mo≈ænost√≠ loga uprost≈ôed. St√°hne PNG i SVG.">
  <!-- Tailwind pro vzhled (voliteln√©) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- QRCode knihovna (toCanvas/toString) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
  <style>
    html,body{height:100%}
    .card{border-radius:1.5rem}
  </style>
</head>
<body class="min-h-screen bg-zinc-950 text-zinc-100">
  <div class="mx-auto max-w-7xl px-4 py-8">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-semibold">QR Studio ‚Äî ƒçist√Ω JS</h1>
      <a href="https://grafitctu.github.io/" class="text-sm opacity-70 hover:opacity-100 underline">Grafit</a>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
      <!-- Ovl√°d√°n√≠ -->
      <div class="card p-5 border border-white/10 bg-white/5 backdrop-blur">
        <label class="block text-sm font-medium mb-1">Text / URL</label>
        <textarea id="inpText" placeholder="Zadej URL nebo libovoln√Ω text‚Ä¶" class="w-full rounded-xl px-3 py-2 bg-black/20 border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500 min-h-[90px]">https://grafitctu.github.io/</textarea>

        <div class="grid grid-cols-2 gap-4 mt-4">
          <div>
            <label class="block text-sm mb-1">Velikost (px)</label>
            <input id="inpSize" type="range" min="128" max="2048" step="32" value="512" class="w-full">
            <div class="text-xs opacity-70 mt-1" id="labSize">512 px</div>
          </div>
          <div>
            <label class="block text-sm mb-1">Okraj (modules)</label>
            <input id="inpMargin" type="range" min="0" max="16" step="1" value="4" class="w-full">
            <div class="text-xs opacity-70 mt-1" id="labMargin">4</div>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-4 mt-4">
          <div>
            <label class="block text-sm mb-1">Korekce chyb</label>
            <select id="inpECC" class="w-full rounded-xl px-3 py-2 bg-black/20 border border-white/10">
              <option value="L">L (7%)</option>
              <option value="M">M (15%)</option>
              <option value="Q">Q (25%)</option>
              <option value="H" selected>H (30%)</option>
            </select>
          </div>
          <div>
            <label class="block text-sm mb-1">Barva (tmav√°)</label>
            <input id="inpFg" type="color" value="#000000" class="w-full h-10 rounded-xl bg-transparent cursor-pointer">
          </div>
          <div>
            <label class="block text-sm mb-1">Pozad√≠ (svƒõtl√©)</label>
            <input id="inpBg" type="color" value="#ffffff" class="w-full h-10 rounded-xl bg-transparent cursor-pointer">
          </div>
        </div>

        <div class="mt-4 rounded-2xl border border-white/10 p-4">
          <div class="text-sm font-medium mb-2">üñºÔ∏è Logo uprost≈ôed (voliteln√©)</div>
          <div class="flex items-center gap-3">
            <input id="inpLogo" type="file" accept="image/*" class="text-sm">
            <button id="btnLogoRemove" class="text-xs underline opacity-80 hidden">Odstranit</button>
          </div>
          <div id="logoControls" class="grid grid-cols-2 gap-4 mt-3 hidden">
            <div>
              <label class="block text-xs mb-1">Velikost loga</label>
              <input id="inpLogoScale" type="range" min="0.10" max="0.40" step="0.01" value="0.20" class="w-full">
              <div class="text-xs opacity-70 mt-1" id="labLogoScale">20 % ≈°√≠≈ôky</div>
            </div>
            <div>
              <label class="block text-xs mb-1">Zaoblen√≠</label>
              <input id="inpLogoRound" type="range" min="0" max="32" step="1" value="16" class="w-full">
              <div class="text-xs opacity-70 mt-1" id="labLogoRound">16 px</div>
            </div>
          </div>
        </div>

        <div class="mt-5 flex flex-wrap gap-3">
          <button id="btnPNG" class="rounded-2xl px-4 py-2 bg-indigo-600 hover:bg-indigo-500 transition">St√°hnout PNG</button>
          <button id="btnSVG" class="rounded-2xl px-4 py-2 bg-indigo-600 hover:bg-indigo-500 transition">St√°hnout SVG</button>
          <button id="btnReset" class="rounded-2xl px-4 py-2 border border-white/10 hover:bg-white/10 transition">Reset</button>
        </div>
      </div>

      <!-- N√°hled -->
      <div class="card p-5 border border-white/10 bg-white/5 backdrop-blur flex items-center justify-center">
        <div class="w-full max-w-[min(90vw,720px)]">
          <div class="aspect-square w-full rounded-2xl overflow-hidden bg-white flex items-center justify-center p-3">
            <canvas id="qrCanvas" width="512" height="512" class="w-full h-full"></canvas>
          </div>
          <div class="text-xs opacity-70 mt-3">Tip: Pro tisk pou≈æ√≠vej SVG, pro web PNG. Vysok√° korekce chyb (H) je lep≈°√≠ pro logo uprost≈ôed.</div>
          <div id="svgHolder" class="hidden"></div>
        </div>
      </div>
    </div>

    <footer class="mt-8 text-xs opacity-60">Made with ‚ù§Ô∏è for Grafit ‚Äî ƒçistƒõ v prohl√≠≈æeƒçi, nic se nikam neodes√≠l√°.</footer>
  </div>

  <script>
    // --- Stavy ---
    let state = {
      text: 'https://grafitctu.github.io/',
      size: 512,
      margin: 4,
      ecc: 'H',
      fg: '#000000',
      bg: '#ffffff',
      logoDataUrl: null,
      logoScale: 0.20,
      logoRound: 16,
      svgMarkup: ''
    };

    // --- UI prvky ---
    const el = (id)=>document.getElementById(id);
    const canvas = el('qrCanvas');
    const ctx = canvas.getContext('2d');

    // --- Helpers ---
    function safeFilename(s){
      return (s || 'qr').replace(/[^a-z0-9]+/gi,'-').slice(0,40).toLowerCase();
    }
    function roundRectPath(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x + rr, y);
      ctx.arcTo(x + w, y, x + w, y + h, rr);
      ctx.arcTo(x + w, y + h, x, y + h, rr);
      ctx.arcTo(x, y + h, x, y, rr);
      ctx.arcTo(x, y, x + w, y, rr);
      ctx.closePath();
    }

    // --- Render QR na canvas + logo ---
    async function drawQR(){
      canvas.width = state.size;
      canvas.height = state.size;

      await QRCode.toCanvas(canvas, state.text || '', {
        errorCorrectionLevel: state.ecc,
        margin: state.margin,
        color: { dark: state.fg, light: state.bg },
        width: state.size,
        scale: 1,
      });

      if(state.logoDataUrl){
        await new Promise((resolve)=>{
          const img = new Image();
          img.onload = ()=>{
            const w = canvas.width * state.logoScale;
            const h = w;
            const x = (canvas.width - w)/2;
            const y = (canvas.height - h)/2;
            const r = state.logoRound;

            ctx.save();
            // b√≠l√Ω podklad pod logem (kv≈Øli ƒçitelnosti)
            roundRectPath(ctx, x-8, y-8, w+16, h+16, r+8);
            ctx.fillStyle = state.bg;
            ctx.fill();
            // samotn√° maska pro logo
            roundRectPath(ctx, x, y, w, h, r);
            ctx.clip();
            ctx.drawImage(img, x, y, w, h);
            ctx.restore();
            resolve();
          };
          img.src = state.logoDataUrl;
        });
      }
    }

    // --- Vytvo≈ô SVG markup (pro download) ---
    async function buildSVG(){
      state.svgMarkup = await QRCode.toString(state.text || '', {
        type: 'svg',
        errorCorrectionLevel: state.ecc,
        margin: state.margin,
        color: { dark: state.fg, light: state.bg },
        width: state.size,
        scale: 1,
      });
      el('svgHolder').innerHTML = state.svgMarkup;
    }

    // --- Aktualizace UI label≈Ø ---
    function updateLabels(){
      el('labSize').textContent = state.size + ' px';
      el('labMargin').textContent = state.margin;
      el('labLogoScale').textContent = Math.round(state.logoScale*100) + ' % ≈°√≠≈ôky';
      el('labLogoRound').textContent = state.logoRound + ' px';
      const hasLogo = !!state.logoDataUrl;
      el('logoControls').classList.toggle('hidden', !hasLogo);
      el('btnLogoRemove').classList.toggle('hidden', !hasLogo);
    }

    // --- Handlery vstup≈Ø ---
    el('inpText').addEventListener('input', (e)=>{ state.text = e.target.value; rerender(); });
    el('inpSize').addEventListener('input', (e)=>{ state.size = parseInt(e.target.value,10); updateLabels(); rerender(); });
    el('inpMargin').addEventListener('input', (e)=>{ state.margin = parseInt(e.target.value,10); updateLabels(); rerender(); });
    el('inpECC').addEventListener('change', (e)=>{ state.ecc = e.target.value; rerender(); });
    el('inpFg').addEventListener('input', (e)=>{ state.fg = e.target.value; rerender(); });
    el('inpBg').addEventListener('input', (e)=>{ state.bg = e.target.value; rerender(); });

    el('inpLogo').addEventListener('change', (e)=>{
      const f = e.target.files?.[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = ()=>{ state.logoDataUrl = reader.result; updateLabels(); rerender(); };
      reader.readAsDataURL(f);
    });
    el('btnLogoRemove').addEventListener('click', ()=>{
      state.logoDataUrl = null;
      el('inpLogo').value = '';
      updateLabels();
      rerender();
    });

    el('inpLogoScale').addEventListener('input', (e)=>{ state.logoScale = parseFloat(e.target.value); updateLabels(); rerender(); });
    el('inpLogoRound').addEventListener('input', (e)=>{ state.logoRound = parseInt(e.target.value,10); updateLabels(); rerender(); });

    el('btnPNG').addEventListener('click', ()=>{
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = `qr-${safeFilename(state.text)}.png`;
      a.click();
    });
    el('btnSVG').addEventListener('click', ()=>{
      const blob = new Blob([state.svgMarkup], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `qr-${safeFilename(state.text)}.svg`;
      a.click();
      URL.revokeObjectURL(url);
    });
    el('btnReset').addEventListener('click', ()=>{
      state = {
        text: '',
        size: 512,
        margin: 4,
        ecc: 'H',
        fg: '#000000',
        bg: '#ffffff',
        logoDataUrl: null,
        logoScale: 0.20,
        logoRound: 16,
        svgMarkup: ''
      };
      // reset input≈Ø
      el('inpText').value = '';
      el('inpSize').value = 512;
      el('inpMargin').value = 4;
      el('inpECC').value = 'H';
      el('inpFg').value = '#000000';
      el('inpBg').value = '#ffffff';
      el('inpLogo').value = '';
      el('inpLogoScale').value = 0.20;
      el('inpLogoRound').value = 16;
      updateLabels();
      rerender();
    });

    async function rerender(){
      await drawQR();
      await buildSVG();
    }

    // start
    updateLabels();
    rerender();
  </script>
</body>
</html>
